---
layout: post
title:  "rsyslog-понимание логов"
date:   2011-01-06 01:29:21 +0300
categories: logs
tags: logs
---

# rsyslog-понимание логов

-rw-r-----  1 root     root                   0 Aug  3 11:50 NetworkManager
-rw-r--r--  1 root     root              692761 Aug  3 13:33 Xorg.0.log
-rw-r--r--  1 root     root              198477 Jul 18 16:00 Xorg.0.log.old
-rw-r--r--  1 root     root               44176 Mar 22 14:00 Xorg.1.log
-rw-r--r--  1 root     root               49300 Feb 11 17:42 Xorg.1.log.old
-rw-r--r--  1 root     root               44176 Mar 22 14:01 Xorg.2.log
drwx------  2 root     root                4096 Mar  9 12:58 YaST2

-rw-r-----  1 root     root                   0 Aug  3 11:50 acpid    - логи о питании


-rw-r--r--  1 root     root               99980 Aug  1 16:05 alternatives.log
drwxr-x---  2 root     root                4096 Jul 18 19:03 apache2
drwxr-xr-x  2 root     root                4096 Apr 25 12:31 apparmor
drwx------  2 root     root                4096 Jul 28 03:02 audit
-rw-r--r--  1 root     root               19484 Jul 19 09:00 boot.log
-rw-------  1 root     root              113280 Jul 28 22:23 btmp
drwxr-xr-x  2 lp       lp                  4096 Jul  4 21:04 cups
-rw-------  1 root     root               32096 Mar 28 15:34 faillog
-rw-r-----  1 root     root                   0 Aug  3 11:50 firewall
drwxrwxr-x  3 root     lp                  4096 Oct 25  2015 hp
drwxr-sr-x  3 root     systemd-journal     4096 Jun  1 15:33 journal
-rw-r--r--  1 root     root              285658 Jul 19 09:00 kdm.log
drwx------  2 root     root                4096 Jul 14 17:11 krb5
-rw-r--r--  1 root     root              292876 Jul 28 22:23 lastlog
-rw-r-----  1 root     root                   0 Aug  3 11:50 mail
-rw-r-----  1 root     root                   0 Aug  3 11:50 mail.err
-rw-r-----  1 root     root                   0 Aug  3 11:50 mail.info
-rw-r-----  1 root     root                   0 Aug  3 11:50 mail.warn
-rw-r-----  1 root     root              175619 Aug  3 13:45 messages
drwxr-x---  2 news     news                4096 Aug  3 11:50 news
-rw-r--r--  1 root     root               56746 Aug  3 10:32 ntp
-rw-------  1 root     root             3160352 Jul 22 09:31 pbl.log
-rw-r-----  1 root     root             2226529 Aug  3 13:04 pk_backend_zypp
-rw-r-----  1 root     root            10991534 Aug  3 11:04 pk_backend_zypp-1
drwxr-xr-x  2 root     root                4096 Sep 30  2015 sa
drwxr-x---  2 root     root                4096 Jun  2 17:11 samba
-rw-r-----  1 root     root              163410 Aug  3 11:51 snapper.log
drwxr-xr-x  2 root     root                4096 Sep 11  2015 tuned
drwxr-xr-x  2 root     root                4096 Dec 24  2015 updateTestcase-2015-12-24-14-10-58
-rw-r--r--  1 root     root             1857431 Nov 25  2015 vbox-install.log
-rw-r--r--  1 root     root               13902 Aug  3 13:45 warn
-rw-r--r--  1 root     root                2960 Jul 19 08:59 wpa_supplicant.log
-rw-rw-r--  1 root     utmp              228096 Aug  3 13:48 wtmp
drwxr-xr-x  2 root     root                4096 Jul 13 17:32 zypp
-rw-r-----  1 root     root            11217789 Aug  3 11:50 zypper.log









drwxr-xr-x.  2 root   root      4096 Dec  1  2014 anaconda
drwxr-x---.  2 root   root      4096 Jul 31 11:50 audit
-rw-r--r--   1 root   root     13341 Jul  8 13:46 boot.log
-rw-------   1 root   utmp         0 Aug  3 09:35 btmp
drwxr-xr-x.  2 chrony chrony    4096 Nov 24  2015 chrony
-rw-r--r--   1 root   root    173709 Aug  3 13:55 cron
-rw-r--r--   1 root   root     54917 Jul  8 13:46 dmesg
-rw-r--r--   1 root   root        92 Dec 11  2014 firewalld
-rw-------.  1 root   root     25207 Jul  8 13:37 grubby
-rw-r--r--.  1 root   root    293168 Aug  3 09:32 lastlog
-rw-------   1 root   root      7071 Aug  3 08:47 maillog
-rw-------   1 root   root    582085 Aug  3 13:55 messages
drwx------.  2 root   root      4096 Jun 10  2014 ppp
drwxr-xr-x.  2 root   root      4096 Aug  3 00:00 sa
-rw-------   1 root   root     14592 Aug  3 09:32 secure
-rw-------   1 root   root         0 Jul 31 09:25 spooler
-rw-------.  1 root   root         0 Dec  1  2014 tallylog
drwxr-xr-x.  2 root   root      4096 Mar 31 18:53 tuned
-rw-rw-r--.  1 root   utmp    114432 Aug  3 09:35 wtmp
-rw-------   1 root   root     20731 Aug  3 09:35 yum.log
drwxr-xr-x   2 zabbix zabbix    4096 Jul 31 09:25 zabbix





Файлы wtmp и utmp отслеживают пользователей, вошедших и покинувших систему. Содержимое данных журналов нельзя читать с помощью простой команды «cat», для этого есть специальные команды, с которыми теперь нужно ознакомиться.
last, who


lastlog -  Чтобы узнать время последнего входа в систему, используйте lastlog:


Файлы wtmp и btmp являются исключениями. wtmp отслеживает вход в систему, а btmp содержит информацию о неудавшихся попытках входа.

/var/log/messages - содержит глобальные системные логи Linux, в том числе те, которые регистрируются при запуске системы. В этот лог записываются несколько типов сообщений: это почта, cron, различные сервисы, ядро, аутентификация и другие.

/var/log/dmesg - содержит сообщения, полученные от ядра. Регистрирует много сообщений еще на этапе загрузки, в них отображается информация об аппаратных устройствах, которые инициализируются в процессе загрузки. Можно сказать это еще один лог системы Linux. Количество сообщений в логе ограничено, и когда файл будет переполнен, с каждым новым сообщением старые будут перезаписаны. Вы также можете посмотреть сообщения из этого лога с помощью команды dmseg.

/var/log/auth.log - содержит информацию об авторизации пользователей в системе, включая пользовательские логины и механизмы аутентификации, которые были использованы.

/var/log/boot.log - Содержит информацию, которая регистрируется при загрузке системы.

/var/log/daemon.log - Включает сообщения от различных фоновых демонов

/var/log/kern.log - Тоже содержит сообщения от ядра, полезны при устранении ошибок пользовательских модулей, встроенных в ядро.

/var/log/lastlog - Отображает информацию о последней сессии всех пользователей. Это нетекстовый файл, для его просмотра необходимо использовать команду lastlog.

/var/log/maillog /var/log/mail.log - журналы сервера электронной почты, запущенного в системе.

/var/log/user.log - Информация из всех журналов на уровне пользователей.

/var/log/Xorg.x.log - Лог сообщений Х сервера.

/var/log/alternatives.log - Информация о работе программы update-alternatives. Это символические ссылки на команды или библиотеки по умолчанию.

/var/log/btmp - лог файл Linux содержит информацию о неудачных попытках входа. Для просмотра файла удобно использовать команду last -f /var/log/btmp

/var/log/cups - Все сообщения, связанные с печатью и принтерами.

/var/log/anaconda.log - все сообщения, зарегистрированные при установке сохраняются в этом файле

/var/log/yum.log - регистрирует всю информацию об установке пакетов с помощью Yum.

/var/log/cron - Всякий раз когда демон Cron запускает выполнения программы, он записывает отчет и сообщения самой программы в этом файле.

/var/log/secure - содержит информацию, относящуюся к аутентификации и авторизации. Например, SSHd регистрирует здесь все, в том числе неудачные попытки входа в систему.

/var/log/wtmp или /var/log/utmp - системные логи Linux, содержат журнал входов пользователей в систему. С помощью команды wtmp вы можете узнать кто и когда вошел в систему.

/var/log/faillog - лог системы linux, содержит неудачные попытки входа в систему. Используйте команду faillog, чтобы отобразить содержимое этого файла.

/var/log/mysqld.log - файлы логов Linux от сервера баз данных MySQL.

/var/log/httpd/ или /var/log/apache2 - лог файлы linux11 веб-сервера Apache. Логи доступа находятся в файле access_log, а ошибок в error_log

/var/log/lighttpd/ - логи linux веб-сервера lighttpd

/var/log/conman/ - файлы логов клиента ConMan,

/var/log/mail/ - в этом каталоге содержатся дополнительные логи почтового сервера

/var/log/prelink/ - Программа Prelink связывает библиотеки и исполняемые файлы, чтобы ускорить процесс их загрузки. /var/log/prelink/prelink.log содержит информацию о .so файлах, которые были изменены программой.

/var/log/audit/- Содержит информацию, созданную демоном аудита auditd.

/var/log/setroubleshoot/ - SE Linux использует демон setroubleshootd (SE Trouble Shoot Daemon) для уведомления о проблемах с безопасностью. В этом журнале находятся сообщения этой программы.

/var/log/samba/ - содержит информацию и журналы файлового сервера Samba, который используется для подключения к общим папкам Windows.

/var/log/sa/ - Содержит .cap файлы, собранные пакетом Sysstat.

/var/log/sssd/ - Используется системным демоном безопасности, который управляет удаленным доступом к каталогам и механизмами аутентификации.






Чтобы понять, что все это значит, нужно рассмотреть типы объектов, которые распознает Linux:

    auth or authpriv: Сообщения, поступающие от сервисов авторизации и безопасности;
    kern: сообщения ядра Linux;
    mail: сообщения подсистемы почты;
    cron: сообщения демона Cron;
    daemon: сообщения от демонов;
    news: сообщения подсистемы новостей сети;
    lpr: сообщения, связанные с печатью;
    user: сообщения пользовательских программ;
    local0 до local7:Зарезервировано для локального использования.

    
    Источник (он же категория) может быть следующим:

    0 - kern -  Сообщения ядра
    1 - user -  Сообщения пользовательских программ
    2 - mail -  Сообщения от почтовой системы.
    3 - daemon - Сообщения от тех системных бесов, которые в отличие от FTP или LPR не имеют выделенных специально для их категорий.
    4 - auth - Все что связано с авторизацией юзеров, вроде login и su (безопасность/права доступа)
    5 - syslog - Система протоколирования может протоколировать сообщения от самой себя.
    6 - lpr - Сообщения от системы печати.
    7 - news - Сообщения от сервера новостей. (в настоящее время не употребляется)
    Управление бесом syslogd и журналированием в Linux
    8 - uucp - Сообщения от UNIX-to-UNIX Copy Protocol. Это часть истории UNIX и вероятнее всего она для вас никогда не понадобится (хотя до сих пор определенная часть почтовых сообщений доставляется через UUCP).
    9 - cron - Сообщения от системного планировщика.
    10 - authpriv - То же самое, что и auth, но сообщения этой категории записываются в файл, который могут читать только некоторые пользователи (может быть, эта категория выделена потому, что принадлежащие ей сообщения могут содержать открытые пароли юзеров, которые не должны попадать на глаза посторонним людям, и как надо файлы протоколов должны иметь соответствующие права доступа).
    11 - ftp - При помощи этой категории вы сможете поменять ваш FTP сервер, что бы он записывал свои деяния.
    12 - NTP - сообщения сервера времени
    13 - log audit
    14 - log alert
    15 - clock daemon - сообщения беса времени
    с Шестнадцать по 20 три   local0 - local7 Зарезервированные категории для использования администратором системы. Категория local7 обычно употребляется для сообщений, генерируемых на шаге загрузки системы.
    mark (не имеющая цифрового эквивалента) - присваивается отдельным сообщениям, создаваемым самим бесом syslogd

    
    
    
Ниже приведен список приоритетов по возрастанию:

    Debug: Отладочная информация от программ;
    info: простое информационное сообщение – никакого вмешательства не требуется;
    notice: состояние, которое может потребовать внимания;
    warn: Предупреждение;
    err: ошибка;
    crit: критическое состояние;
    alert: состояние, требующее немедленного вмешательства;
    emerg: аварийное состояние.


Это для тестирование логов
Теперь нужно вызвать приложение logger, чтобы создать сообщение:
[root@TestLinux ~]# logger -p local4.info " This is a info message from local 4"


Затем запустите команду logrotate:
[root@TestLinux ~]# logrotate -fv /etc/logrotate.conf





Свойства, задаваемые в конфигурационном файле logrotate.conf:

        compress | nocompress (старые версии сжимаются или не сжимаются с помощью gzip)

    compresscmd (задает программу сжатия, по умолчанию - gzip)
    uncompresscmd (задает программу разжатия, по умолчанию - ungzip)
    compressext (задает суффикс для сжатых файлов)
    compressoptions (задает свойства программы сжатия; по умолчанию - "-9", т.е. наибольшее сжатие для gzip)
    copytruncate | nocopytruncate (обычно старая версия переименовывается и создается новая версия журнала; при задании этого параметра logrotate копирует журнал в новый файл, а позже обрезает старый; употребляется, если программа, создающая журнал, не умеет его закрывать; теряются записи, сделанные в промежутке меж копированием и обрезанием; а поможет ли, если создающая журнал программа вместо режима append просто пишет в файл, используя внутренний указатель?)
    create [права-доступа владелец группа] | nocreate (слету после переименования старой версии журнала и до вызова postrotate создается новый журнал с обозначенными атрибутами - права доступа задаются в восьмеричном виде, как в chmod.2; если атрибуты не указаны, то берутся от старого журнала)
    daily (смена версий в серии происходит раз в денек)
    delaycompress | nodelaycompress (некоторые программы не слету закрывают журнал, в этом случае сжатие необходимо отложить до следующего цикла)
    errors email (кому направлять сообщения об ошибках)
    extension суффикс (задается суффикс, добавляемый к именам файлов при ротации перед суффиксом сжатия)
    ifempty | notifempty (смена версий даже если файл пуст; действует по умолчанию)
    include имя-файла | имя-директории (текстуально подставить файл или все файлы из обозначенной директории; не врубаются поддиректории, особенные файлы и файлы с суффиксами из списка исключений; нельзя использовать внутри секции)
    mail адрес | nomail (когда смена версий приводит к необходимости удалить старый журнал, то выслать его по обозначенному адресу)
    mailfirst (посылать не удаляемую версию журнала, а первую)
    maillast (посылать удаляемую версию журнала; действует по умолчанию)
    missingok | nomissingok (не посылать сообщения об ошибке, если журнал отсутствует)
    monthly (смена версий происходит каждый месяц)
    olddir директория | noolddir (во время смены версий журнал перемещается в обозначенную директорию; д.б. на том же физическом устройстве)
    postrotate (все следующие строчки до строки endscript исполняются как команды shell после процесса смены версии)
    prerotate (все следующие строчки до строки endscript исполняются перед процессом смены версии)
    rotate число (сколько старых версий хранить; если 0, то ни одной)
    size б (смена версии происходит, если размер журнала превысил обозначенное число; можно использовать суффиксы "k" - кб - и "M" - мб)
    sharedscripts | nosharedscripts (делать команды prerotate и postrotate только один раз для всех файлов, обрисованных в секции)
    tabooext [+] список-суффиксов (задание списка суффиксов-исключений для include; если указан знак "плюс", то дополнение, по другому замена; по умолчанию: .rpmorig, .rpmsave, .rpmnew, ",v", .swp и "~")
    weekly (смена версий происходит раз в неделю)
