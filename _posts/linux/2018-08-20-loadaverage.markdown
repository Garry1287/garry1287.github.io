---
layout: post
title:  "loadaverage"
date:   2018-08-20 02:50:53 +0300
categories: linux
tags: linux
---

# loadaverage
Если упрощённо, то это и есть кол-во процессов(на самом деле kernel visible threads) в состоянии R(running).
 Т.е. коговорит "скока программ активно работают на компьютере". 
Правда, если программа работает с высоким приоритетом, то она попадает в очередь на выполнение несколько раз и сильно повышает LA. 
И вообще, в "новом" cpu-шедулере линуха понятия очереди как тавого нет, но это мелочи.


средняя длина очереди процессов в состоянии "готов к исполнению" за 1, 5, 15 минут соответственно.

 load average - среднее число активных процессов. Совершенно непоказательная
величина (у меня как-то было la>20 при <50% загрузки процессора).



Load average (la) - это количество процессов, стоящих в очереди на исполнение.
 Если значение высокое, значит, некоторым процессам приходится ждать, пока другие освободят ресурсы сервера.
 В результате время исполнения некоторых процессов может сильно увеличиваться. Если сайт достаточно нагружен, 
то очередь понемногу растет и в итоге сайт вообще перестает откликаться.
В la три числа - это среднее количество процессов в очереди за 1, 5 и 15 минут.
Теоретически la должно быть меньше количества ядер. На VPS клиенту часто выделяют одно ядро, 
поэтому la 1-1.5 может быть пределом, при котором не заметно тормозов. 
А на shared-хостинге в la статистика по всем ядрам, поэтому и 4-6 могут быть нормальным показателем.

Каждый раз, когда scheduler операционной системы приостанавливает выполнение какого-то процесса (или этот процесс сам отдаёт процессор), 
он должен выбрать другой процесс и запустить его.
 Для этого у него есть список процессов, которые ждут, пока для них освободится процессор. load average это средняя длина этого списка


[http://www.colobridge.net/wiki/faq/%D1%87%D1%82%D0%BE_%D1%82%D0%B0%D0%BA%D0%BE%D0%B5_load_average](http://www.colobridge.net/wiki/faq/%D1%87%D1%82%D0%BE_%D1%82%D0%B0%D0%BA%D0%BE%D0%B5_load_average)
[http://luv.asn.au/overheads/NJG_LUV_2002/luvSlides.html](http://luv.asn.au/overheads/NJG_LUV_2002/luvSlides.html)



%wa Параметр wa говорит о простое, связанным с вводом/выводом:  Выше 80% считается не совсем нормальным и явно указывает нам на то, что процессор проводит очень много времени в ожидании ввода/вывода (обычно это означает, что выходит из строя HDD или NIC).
%ni — процент использования процессорного времени процессами с измененным приоритетом nice (я выше спрашивал зачем он)
%id — простой процессора (ну тут все ясно)
%hi — процент времени, которое процессор тратит на обработку прерываний на уровне железа (IRQ)
%si — то же, что и %hi, только для софт-прерываний 

%Cpu(s):  9.8 us,  2.5 sy,  0.0 ni, 87.7 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st


Ещё одна мало известная фишка в выводе top — это параметр %st, также известный как «steal time», который можно перевести как «процент уворованного времени».

Он имеет смысл только в виртуальном окружении и обозначает процент процессорного времени, которое хост использовал по своему усмотрению в то время, как ваша виртуальная машина в нём нуждалась.

Увеличение %st более чем на 5-10% говорит о том, что пора переходить более мощный VPS план или мигрировать на физический сервер. 

Состояния процессора

    us — (User CPU time) время, затраченное на работу программ пользователей
    sy — (System CPU time) время, затраченное на работу процессов ядра
    ni — (Nice CPU time) время, затраченное на работу программ с измененным приоритетом
    id — простой процессора
    wa — (iowait) время, затраченное на завершение ввода/вывода
    hi — (Hardware IRQ) время, затраченное на обработку hardware-прерываний
    si — (Software Interrupts) время, затраченное на работу обработку software-прерываний (network)
    st — (Steal Time) время, «украденное» гипервизором у этой виртуальной машины для других задач (например работа другой виртуальной машины)
