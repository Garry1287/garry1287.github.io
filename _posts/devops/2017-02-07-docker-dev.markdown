---
layout: post
title:  "Окружение dev stage prod"
date:   2017-02-07 20:20:59 +0400
categories: docker-dev
tags: devops
---

# docker-dev

Ох, мы с такими зоопарками говна наелись, особенно когда у разработчиков стали расходиться версии докера в их дев-окружениях. В итоге для нас хорошо рабочим вариантом стало так:

    Докер-кластер (кубик) в проде, все хосты идентичные.
    Staging-кластер, окружение хостов идентично проду.
    Dev-кластер, идентичное окружение. Используется для сборки имиджей, запуска промежуточных тестов, и просто на поиграться разработчикам. 

Местами в некритичных контейнерах мы используем отличные от хостовых дистрибутивы. На практике не сталкивались с проблемами, описанными alpha, хотя наслышаны. С другой стороны, у докера и помимо этого куча болячек, хоть за последние пару лет мы сталкиваемся с ними все реже и реже.



[https://toster.ru/q/22512](https://toster.ru/q/22512)

WP блог с ~30k уников в день, три выделенных сервера в распоряжении. У меня стоит две задачи: построить fail-safe работу двух (трёх?) продакшн серверов (один серв. упал, сайт жив); и организовать работу сторонних фриланс-разработчиков, которые будут обновлять сайт.


Предполагаю сделать 1 сервер load balancer'ом, и два зеркальных production — обрабатывать запросы.


Как лучше поступить с разработчиками? Прочитал про Development — (Integration) — Staging — Production. Стоит ли поднимать виртуальные машины для Development и Staging, или вполне можно держать их на одном из продакшн, на отдельном IP, со своей копией БД?

Позволить разработчикам заливать по FTP что-то на продакшн, или жестко ограничить их коммитами в SVN, и только ответственным сотрудникам дать права на запуск деплоймент скриптов из SVN на продакшн?


Что почитать про Best Practices организации работы разработчиков над проектом? 







Разработчики должны иметь свое изолированное окружение, обычно локальное
Дальше неплохо иметь промежуточный dev сервер, как для последнего прогона тестов, так и для интеграционных тестов
Далее dev копируется в продакшн, или снепшот из продакшена копируется в дев и они меняются ( если что можно мгновенно переключиться в старый )
Заливка из VCS только в дев.

Можно ли ставить дев и продакшн в одной среде зависит от того когда тестируется производительность и прочие нагрузочные вещи. Если до заливки в дев, то можно, иначе — нельзя — есть риск завалить тестами или кривыми изменениями.

Я бы сделал один сервер в продакшн, второй в реплику и третий дев. При сем дев и продакшн менял местами и бекапил бы их вдруг в друга, а реплика имела бы два контейнера или набора серверов соответствующие двум другим машинам. 


[https://toster.ru/q/22512](https://toster.ru/q/22512)
