---
layout: post
title:  "BGP-site"
date:   2013-06-19 23:58:32 +0400
categories: routing
tags: routing
---

# BGP-site


Настройка: billing nodeny, stargazer, abbils. Cisco.

Есть два реплицируемых кластера, размещенных в разных датацентрах. При использовании Round-Robin DNS запросы приходят то туда, то сюда.
Но репликация запаздывает, и такой режим работы неудобен.

Подскажите, пожалуйста, есть ли какие-нибудь системы или сервисы DNS, способные динамически определять нерабочий кластер,
 чтобы направлять запросы только на исправный кластер?
Или даже с ручным, но быстрым переключением подойдет.
Спасибо!

На каждый узел кластер, принимающий траифик (фронтенд) делается файловер в самом дц.
Не понимаю, зачем вы все делаете одинаковые ошибки?

Файловер на уровне ДЦ делается через bgp




Файловер на уровне ДЦ делается через bgp
Нашел такую статью: "Поднимаем BGP используя quagga на FreeBSD" [http://subnets.ru/blog/?p=19](http://subnets.ru/blog/?p=19)
Это оно?
Подскажите, пожалуйста, с помощью какого софта это обычно делают на FreeBSD?

Я bgp никогда не использовал. Реально ли поднять и сопровождать самому по статьям, или надежнее воспользоваться готовыми сервисами?
И еще - у нас нет своей АС, это критично?

Критично
Как будет автономка - обращайтесь, проконсультирую


И связки ispmanager+nginx нет, nginx+apache, nginx+fastcgi, ispmanager не участвует в работе сервера
mod_fastcgi неплохо помогает... ну и опять же: eaccelerator, кеширование настроено??? mysqltuner и tuning-primer показывают что все отлично??? 
с помощью ab (или других утилит) тестировали???

lighttpd ни к чему, nginx такой же...
htop установи и сделай скрин (уже отвык от top)...
eaccelerator есть?
nginx worker_processes??
mysqltuner и tuning-primer проверка базы???
mod-fastcgi в той же ispmanager устанавливается через возможности...


mysqldump
sypex dumper
[http://www.percona.com/software/percona-xtrabackup](http://www.percona.com/software/percona-xtrabackup)


проверьте сайт тут
host-tracker.com
tools.pingdom.com/fpt




На Асе
O E1 10.192.10.60 255.255.255.252            [110/12] via 10.50.253.11, 156:42:47, outside

На балансере
Routing entry for 10.192.10.60/30   
  Known via "ospf 110", distance 110, metric 101                                                                                                             
  Tag 20485, type extern 1
  Last update from 10.50.254.1 on FastEthernet0/0.10, 6d12h ago
  Routing Descriptor Blocks:
    10.50.254.4, from 10.192.10.54, 6d12h ago, via FastEthernet0/0.10
      Route metric is 101, traffic share count is 1
      Route tag 20485
  * 10.50.254.1, from 10.192.10.50, 6d12h ago, via FastEthernet0/0.10
      Route metric is 101, traffic share count is 1
      Route tag 20485















Altai-TTK-LB0#sh ip route 10.192.10.60
Routing entry for 10.192.10.60/30
  Known via "ospf 110", distance 110, metric 2
  Tag 3216, type extern 1
  Last update from 10.74.254.1 on GigabitEthernet0/0.10, 3d13h ago
  Routing Descriptor Blocks:
    10.74.254.4, from 10.192.10.126, 3d13h ago, via GigabitEthernet0/0.10
      Route metric is 2, traffic share count is 1
      Route tag 3216
  * 10.74.254.1, from 10.192.10.74, 3d13h ago, via GigabitEthernet0/0.10
      Route metric is 2, traffic share count is 1
      Route tag 3216



Узнал много нового про BGP и AS, спасибо Андрейке, что навел на тему!

Правильно ли я понимаю, что PI адреса v4 сейчас купить уже нет шансов, но можно что-то сделать похожее на PA-адресах?
Т.е. один провайдер мне выделяет свой IP адрес, а другой аннонсирует его на своем маршрутизаторе?

Если да, то непонятно, как будет происходить переключение с IP в одном датацентре на тот же IP в другом датацентре? Мне потребуется ставить свои маршрутизаторы в обоих датацентрах и самому там что-то переключать, или это делается на уровне провайдеров?

Спасибо за ответ!


Вовсе нет, AS не требуется, достаточно небольшого сегмента PA/PI адресов, который будет аннонсироваться с разных мест 
(с резервного пути с препендом).

То есть, это выглядит как:
1) Клиент хочет подключитсья к вашему сервису
2) Обращается к провайдеру, получить данные от узла 7.7.7.7
3) Првоайдер смотрит в роутинг таблицу (BGP Fulltable) и видит, что адрес 7.7.7.7 доступен из ДЦ 1 и из ДЦ 2, 
но по причине препенда для ДЦ2 (искуссственного указания, что данный путь хуже) трафик пойдет в ДЦ1
4) ДЦ1 целиком падает и маршрут пропадает из Интернета
5) Весь трафик идет на узел ДЦ2

Вот как-то вот так. То есть надо два провайдера с возможностью анонса собственных сетей, свою сеть (от /24),
 а также возможности препенда при анонсе от провайдеров, иначе трафик разольется по обоим дц равномерно.



Требуется уверенное знание операционной системы Linux (Debian, CentOS), а также опционально FreeBSD и Windows Server 2008.
Требуется уверенное понимание и опыт эксплуатации и поддержки следующих технологий в контексте указанных ОС:

    ISPManager
    Apache
    Nginx
    MySQL
    PHP (с точки зрения администрирования)
    Postfix либо Exim либо Sendmail
    Bind
    Soft Raid (программный RAID)
    Dovecot
    Proftpd





